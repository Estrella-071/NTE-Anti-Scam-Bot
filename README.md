# 巡哨鼠鼠 (PatrolMouse)

這是一個輔助 Discord 伺服器管理員處理洗版、廣告與免洗帳號的自動化防禦機器人。
本專案透過分析發言頻率與跨頻道特徵，攔截惡意訊息並自動執行階段性處置，並提供介面供管理員覆核。

## 功能機制

### 1. 雙重洗版偵測系統

系統實作了兩套獨立的偵測演算法：

* 快速洗版防禦
以漏桶演算法實作。每位使用者具有獨立的計數水桶，發送訊息會增加水位，水桶隨時間恆定流失。
當短時間內水位溢出即判定為洗版。針對送出大量隨機內容或計數序列的行為，系統會擷取最後 5 則不重複訊息作為判斷樣本，防範刻意規避。

* 慢速跨頻洗版防禦
當使用者將完全相同的字串發送至 3 個以上的不同頻道時，系統會記錄該字串指紋。
若一小時內跨頻道發送相同內容達門檻，將無視發送頻率直接觸發防禦。

### 2. 累進式積分與處分

違規處置採積分制 (通緝值)，每次觸發警報皆會累加星數 (⭐️)，並自動執行對應處罰：

* 0 ⭐️ ⮕ 1 ⭐️：刪除該波違規訊息
* 1 ⭐️ ⮕ 2 ⭐️：刪除訊息，禁言 5 分鐘
* 2 ⭐️ ⮕ 3 ⭐️：刪除訊息，禁言 15 分鐘
* 3 ⭐️ ⮕ 4 ⭐️：刪除訊息，禁言 1 小時
* 直接判定為 4 ⭐️：若觸發慢速跨頻洗版，將刪除訊息並禁言 28 天，等待人工審核。

系統內建排程，每經過七天未再犯，會自動扣除 1 顆星的通緝值。

### 3. 通報與人工覆核介面

違規觸發後，機器人會於指定的內部頻道發送通報。
通報內容包含違規者 ID、觸發頻道、觸發原因與擷取內容。惡意連結會在擷取時被自動遮蔽(例如)處理。

通報下方提供編輯操作面板。具備 Administrator 或 BanMembers 權限的管理員可點擊按鈕，選擇：
* 解除禁言：若判定為誤判，可一鍵解除該使用者的禁言狀態。
* 永久停權：確認為惡意帳號，直接執行 Ban。

管理員完成處置後，該通報的面板按鈕將被收回，並將處置結果與操作者的 ID 更新至通報內容中，避免重複處理。

## 技術棧

* TypeScript, Node.js
* Discord.js (v14)
* Better-SQLite3: 用於本地儲存通緝積分與時間戳記。

## 設定環境變數
1. 在本專案資料夾中，找到 `.env.example` 檔案，將其重新命名為 `.env`。
2. 使用文字編輯器打開 `.env`，填入對應的資料：
   * `BOT_TOKEN=`
   * `REPORT_CHANNEL_ID=` 用來接收違規通報的頻道 ID
